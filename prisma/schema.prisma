//////////////////////////////////////////////////////////////////////////////////////////////
// DO NOT MODIFY THIS FILE                                                                  //
// This file is automatically generated by ZenStack CLI and should not be manually updated. //
//////////////////////////////////////////////////////////////////////////////////////////////

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  binaryTargets   = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x", "darwin", "darwin-arm64", "windows"]
  previewFeatures = ["typedSql"]
  output          = "../generated/prisma-client"
}

/// Enum cho vai trò người dùng
enum UserRole {
  USER
  ADMIN
}

enum PlaceType {
  INDOOR
  OUTDOOR
}

enum MediaType {
  IMAGE
  VIDEO
}

enum RequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id             String               @id() @default(uuid())
  email          String               @unique()
  password       String
  name           String
  phoneNumber    String?
  address        String?
  numberOfKids   Int                  @default(0)
  role           UserRole             @default(USER)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt()
  isActive       Boolean              @default(true)
  reviews        Review[]
  favorites      Favorite[]
  uploadedMedia  Media[]
  updateRequests PlaceUpdateRequest[]

  @@map("users")
}

model Place {
  id              String               @id() @default(uuid())
  name            String
  description     String?
  address         String
  latitude        Float
  longitude       Float
  placeType       PlaceType
  minAge          Int                  @default(0)
  maxAge          Int                  @default(100)
  area            Float?
  openingTime     String?
  closingTime     String?
  phoneNumber     String?
  website         String?
  imageUrl        String?
  externalPlaceId String?              @unique()
  averageRating   Float                @default(0)
  totalReviews    Int                  @default(0)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt()
  isActive        Boolean              @default(true)
  price           Float?
  reviews         Review[]
  favorites       Favorite[]
  media           Media[]
  updateRequests  PlaceUpdateRequest[]

  @@map("places")
}

model Review {
  id        String   @id() @default(uuid())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt()
  userId    String
  placeId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  place     Place    @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model Favorite {
  id        String   @id() @default(uuid())
  createdAt DateTime @default(now())
  userId    String
  placeId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  place     Place    @relation(fields: [placeId], references: [id], onDelete: Cascade)

  @@unique([userId, placeId])
  @@map("favorites")
}

model Media {
  id                String    @id() @default(uuid())
  fileName          String
  fileUrl           String
  fileSize          Int?
  mimeType          String?
  mediaType         MediaType
  title             String?
  altText           String?
  sortOrder         Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt()
  isActive          Boolean   @default(true)
  isPendingApproval Boolean   @default(false)
  placeId           String
  uploadedBy        String?
  place             Place     @relation(fields: [placeId], references: [id], onDelete: Cascade)
  uploader          User?     @relation(fields: [uploadedBy], references: [id], onDelete: SetNull)

  @@map("media")
}

model PlaceUpdateRequest {
  id              String        @id() @default(uuid())
  status          RequestStatus @default(PENDING)
  description     String?
  area            Float?
  openingTime     String?
  closingTime     String?
  minAge          Int?
  maxAge          Int?
  price           Float?
  rejectionReason String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt()
  reviewedAt      DateTime?
  placeId         String
  userId          String
  reviewedBy      String?
  place           Place         @relation(fields: [placeId], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("place_update_requests")
}
